import math
import logging
from dataclasses import dataclass, field
from pathlib import Path
from examples.plugins import GeneralPlugin

PLUGIN_NAME=Path(__file__).name.split('.')[0]
CSV_FILE=Path('../csv_testdata/Smoother.csv')

@dataclass
class Input:
    start_value: float = 0
    function: callable = None


@dataclass
class Output:
    value: float = 0


def run(input: Input, output: Output, log: logging.Logger):
    output.value = input.function(input.start_value)

def run_post(input: Input, output: Output, log: logging.Logger):
    input.start_value = input.start_value+1


def test():
    testdata = [{'clock_tick': 0.0, 'input.start_value': 0.0, 'output.value': 0.0, 'log': '', 'Generator.py': ''}, {'clock_tick': 1.0, 'input.start_value': 1.0, 'output.value': 0.9999833334166665, 'log': '', 'Generator.py': ''}, {'clock_tick': 2.0, 'input.start_value': 2.0, 'output.value': 1.999866669333308, 'log': '', 'Generator.py': ''}, {'clock_tick': 3.0, 'input.start_value': 3.0, 'output.value': 2.999550020249566, 'log': '', 'Generator.py': ''}, {'clock_tick': 4.0, 'input.start_value': 4.0, 'output.value': 3.998933418663416, 'log': '', 'Generator.py': ''}, {'clock_tick': 5.0, 'input.start_value': 5.0, 'output.value': 4.997916927067833, 'log': '', 'Generator.py': ''}, {'clock_tick': 6.0, 'input.start_value': 6.0, 'output.value': 5.996400647944459, 'log': '', 'Generator.py': ''}, {'clock_tick': 7.0, 'input.start_value': 7.0, 'output.value': 6.994284733753277, 'log': '', 'Generator.py': ''}, {'clock_tick': 8.0, 'input.start_value': 8.0, 'output.value': 7.991469396917269, 'log': '', 'Generator.py': ''}, {'clock_tick': 9.0, 'input.start_value': 9.0, 'output.value': 8.987854919801103, 'log': '', 'Generator.py': ''}, {'clock_tick': 10.0, 'input.start_value': 10.0, 'output.value': 9.983341664682815, 'log': '', 'Generator.py': ''}, {'clock_tick': 11.0, 'input.start_value': 11.0, 'output.value': 10.977830083717482, 'log': '', 'Generator.py': ''}, {'clock_tick': 12.0, 'input.start_value': 12.0, 'output.value': 11.971220728891936, 'log': '', 'Generator.py': ''}, {'clock_tick': 13.0, 'input.start_value': 13.0, 'output.value': 12.963414261969486, 'log': '', 'Generator.py': ''}, {'clock_tick': 14.0, 'input.start_value': 14.0, 'output.value': 13.954311464423649, 'log': '', 'Generator.py': ''}, {'clock_tick': 15.0, 'input.start_value': 15.0, 'output.value': 14.943813247359921, 'log': '', 'Generator.py': ''}, {'clock_tick': 16.0, 'input.start_value': 16.0, 'output.value': 15.931820661424597, 'log': '', 'Generator.py': ''}, {'clock_tick': 17.0, 'input.start_value': 17.0, 'output.value': 16.918234906699603, 'log': '', 'Generator.py': ''}, {'clock_tick': 18.0, 'input.start_value': 18.0, 'output.value': 17.902957342582418, 'log': '', 'Generator.py': ''}, {'clock_tick': 19.0, 'input.start_value': 19.0, 'output.value': 18.88588949765006, 'log': '', 'Generator.py': ''}, {'clock_tick': 20.0, 'input.start_value': 20.0, 'output.value': 19.866933079506122, 'log': '', 'Generator.py': ''}, {'clock_tick': 21.0, 'input.start_value': 21.0, 'output.value': 20.845989984609954, 'log': '', 'Generator.py': ''}, {'clock_tick': 22.0, 'input.start_value': 22.0, 'output.value': 21.822962308086932, 'log': '', 'Generator.py': ''}, {'clock_tick': 23.0, 'input.start_value': 23.0, 'output.value': 22.79775235351884, 'log': '', 'Generator.py': ''}, {'clock_tick': 24.0, 'input.start_value': 24.0, 'output.value': 23.77026264271346, 'log': '', 'Generator.py': ''}, {'clock_tick': 25.0, 'input.start_value': 25.0, 'output.value': 24.740395925452294, 'log': '', 'Generator.py': ''}, {'clock_tick': 26.0, 'input.start_value': 26.0, 'output.value': 25.70805518921551, 'log': '', 'Generator.py': ''}, {'clock_tick': 27.0, 'input.start_value': 27.0, 'output.value': 26.673143668883114, 'log': '', 'Generator.py': ''}, {'clock_tick': 28.0, 'input.start_value': 28.0, 'output.value': 27.635564856411378, 'log': '', 'Generator.py': ''}, {'clock_tick': 29.0, 'input.start_value': 29.0, 'output.value': 28.595222510483552, 'log': '', 'Generator.py': ''}, {'clock_tick': 30.0, 'input.start_value': 30.0, 'output.value': 29.552020666133956, 'log': '', 'Generator.py': ''}, {'clock_tick': 31.0, 'input.start_value': 31.0, 'output.value': 30.50586364434435, 'log': '', 'Generator.py': ''}, {'clock_tick': 32.0, 'input.start_value': 32.0, 'output.value': 31.456656061611778, 'log': '', 'Generator.py': ''}, {'clock_tick': 33.0, 'input.start_value': 33.0, 'output.value': 32.40430283948684, 'log': '', 'Generator.py': ''}, {'clock_tick': 34.0, 'input.start_value': 34.0, 'output.value': 33.34870921408144, 'log': '', 'Generator.py': ''}, {'clock_tick': 35.0, 'input.start_value': 35.0, 'output.value': 34.28978074554514, 'log': '', 'Generator.py': ''}, {'clock_tick': 36.0, 'input.start_value': 36.0, 'output.value': 35.227423327508994, 'log': '', 'Generator.py': ''}, {'clock_tick': 37.0, 'input.start_value': 37.0, 'output.value': 36.1615431964962, 'log': '', 'Generator.py': ''}, {'clock_tick': 38.0, 'input.start_value': 38.0, 'output.value': 37.09204694129827, 'log': '', 'Generator.py': ''}, {'clock_tick': 39.0, 'input.start_value': 39.0, 'output.value': 38.01884151231614, 'log': '', 'Generator.py': ''}, {'clock_tick': 40.0, 'input.start_value': 40.0, 'output.value': 38.941834230865055, 'log': '', 'Generator.py': ''}, {'clock_tick': 41.0, 'input.start_value': 41.0, 'output.value': 39.86093279844229, 'log': '', 'Generator.py': ''}, {'clock_tick': 42.0, 'input.start_value': 42.0, 'output.value': 40.77604530595701, 'log': '', 'Generator.py': ''}, {'clock_tick': 43.0, 'input.start_value': 43.0, 'output.value': 41.68708024292108, 'log': '', 'Generator.py': ''}, {'clock_tick': 44.0, 'input.start_value': 44.0, 'output.value': 42.59394650659996, 'log': '', 'Generator.py': ''}, {'clock_tick': 45.0, 'input.start_value': 45.0, 'output.value': 43.496553411123024, 'log': '', 'Generator.py': ''}, {'clock_tick': 46.0, 'input.start_value': 46.0, 'output.value': 44.39481069655198, 'log': '', 'Generator.py': ''}, {'clock_tick': 47.0, 'input.start_value': 47.0, 'output.value': 45.28862853790683, 'log': '', 'Generator.py': ''}, {'clock_tick': 48.0, 'input.start_value': 48.0, 'output.value': 46.17791755414829, 'log': '', 'Generator.py': ''}, {'clock_tick': 49.0, 'input.start_value': 49.0, 'output.value': 47.0625888171158, 'log': '', 'Generator.py': ''}, {'clock_tick': 50.0, 'input.start_value': 50.0, 'output.value': 47.942553860420304, 'log': '', 'Generator.py': ''}, {'clock_tick': 51.0, 'input.start_value': 51.0, 'output.value': 48.817724688290745, 'log': '', 'Generator.py': ''}, {'clock_tick': 52.0, 'input.start_value': 52.0, 'output.value': 49.68801378437367, 'log': '', 'Generator.py': ''}, {'clock_tick': 53.0, 'input.start_value': 53.0, 'output.value': 50.55333412048469, 'log': '', 'Generator.py': ''}, {'clock_tick': 54.0, 'input.start_value': 54.0, 'output.value': 51.41359916531131, 'log': '', 'Generator.py': ''}, {'clock_tick': 55.0, 'input.start_value': 55.0, 'output.value': 52.26872289306592, 'log': '', 'Generator.py': ''}, {'clock_tick': 56.0, 'input.start_value': 56.0, 'output.value': 53.11861979208834, 'log': '', 'Generator.py': ''}, {'clock_tick': 57.0, 'input.start_value': 57.0, 'output.value': 53.96320487339692, 'log': '', 'Generator.py': ''}, {'clock_tick': 58.0, 'input.start_value': 58.0, 'output.value': 54.802393679187354, 'log': '', 'Generator.py': ''}, {'clock_tick': 59.0, 'input.start_value': 59.0, 'output.value': 55.63610229127838, 'log': '', 'Generator.py': ''}, {'clock_tick': 60.0, 'input.start_value': 60.0, 'output.value': 56.46424733950354, 'log': '', 'Generator.py': ''}, {'clock_tick': 61.0, 'input.start_value': 61.0, 'output.value': 57.28674601004813, 'log': '', 'Generator.py': ''}, {'clock_tick': 62.0, 'input.start_value': 62.0, 'output.value': 58.10351605373051, 'log': '', 'Generator.py': ''}, {'clock_tick': 63.0, 'input.start_value': 63.0, 'output.value': 58.91447579422695, 'log': '', 'Generator.py': ''}, {'clock_tick': 64.0, 'input.start_value': 64.0, 'output.value': 59.71954413623921, 'log': '', 'Generator.py': ''}, {'clock_tick': 65.0, 'input.start_value': 65.0, 'output.value': 60.51864057360395, 'log': '', 'Generator.py': ''}, {'clock_tick': 66.0, 'input.start_value': 66.0, 'output.value': 61.31168519734338, 'log': '', 'Generator.py': ''}, {'clock_tick': 67.0, 'input.start_value': 67.0, 'output.value': 62.09859870365597, 'log': '', 'Generator.py': ''}, {'clock_tick': 68.0, 'input.start_value': 68.0, 'output.value': 62.87930240184686, 'log': '', 'Generator.py': ''}, {'clock_tick': 69.0, 'input.start_value': 69.0, 'output.value': 63.65371822219679, 'log': '', 'Generator.py': ''}, {'clock_tick': 70.0, 'input.start_value': 70.0, 'output.value': 64.4217687237691, 'log': '', 'Generator.py': ''}, {'clock_tick': 71.0, 'input.start_value': 71.0, 'output.value': 65.18337710215366, 'log': '', 'Generator.py': ''}, {'clock_tick': 72.0, 'input.start_value': 72.0, 'output.value': 65.9384671971473, 'log': '', 'Generator.py': ''}, {'clock_tick': 73.0, 'input.start_value': 73.0, 'output.value': 66.68696350036979, 'log': '', 'Generator.py': ''}, {'clock_tick': 74.0, 'input.start_value': 74.0, 'output.value': 67.4287911628145, 'log': '', 'Generator.py': ''}, {'clock_tick': 75.0, 'input.start_value': 75.0, 'output.value': 68.16387600233341, 'log': '', 'Generator.py': ''}, {'clock_tick': 76.0, 'input.start_value': 76.0, 'output.value': 68.89214451105514, 'log': '', 'Generator.py': ''}, {'clock_tick': 77.0, 'input.start_value': 77.0, 'output.value': 69.61352386273568, 'log': '', 'Generator.py': ''}, {'clock_tick': 78.0, 'input.start_value': 78.0, 'output.value': 70.32794192004103, 'log': '', 'Generator.py': ''}, {'clock_tick': 79.0, 'input.start_value': 79.0, 'output.value': 71.03532724176078, 'log': '', 'Generator.py': ''}, {'clock_tick': 80.0, 'input.start_value': 80.0, 'output.value': 71.73560908995228, 'log': '', 'Generator.py': ''}, {'clock_tick': 81.0, 'input.start_value': 81.0, 'output.value': 72.42871743701426, 'log': '', 'Generator.py': ''}, {'clock_tick': 82.0, 'input.start_value': 82.0, 'output.value': 73.11458297268958, 'log': '', 'Generator.py': ''}, {'clock_tick': 83.0, 'input.start_value': 83.0, 'output.value': 73.79313711099627, 'log': '', 'Generator.py': ''}, {'clock_tick': 84.0, 'input.start_value': 84.0, 'output.value': 74.46431199708593, 'log': '', 'Generator.py': ''}, {'clock_tick': 85.0, 'input.start_value': 85.0, 'output.value': 75.12804051402927, 'log': '', 'Generator.py': ''}, {'clock_tick': 86.0, 'input.start_value': 86.0, 'output.value': 75.78425628952769, 'log': '', 'Generator.py': ''}, {'clock_tick': 87.0, 'input.start_value': 87.0, 'output.value': 76.4328937025505, 'log': '', 'Generator.py': ''}, {'clock_tick': 88.0, 'input.start_value': 88.0, 'output.value': 77.07388788989692, 'log': '', 'Generator.py': ''}, {'clock_tick': 89.0, 'input.start_value': 89.0, 'output.value': 77.70717475268239, 'log': '', 'Generator.py': ''}, {'clock_tick': 90.0, 'input.start_value': 90.0, 'output.value': 78.33269096274834, 'log': '', 'Generator.py': ''}, {'clock_tick': 91.0, 'input.start_value': 91.0, 'output.value': 78.95037396899505, 'log': '', 'Generator.py': ''}, {'clock_tick': 92.0, 'input.start_value': 92.0, 'output.value': 79.5601620036366, 'log': '', 'Generator.py': ''}, {'clock_tick': 93.0, 'input.start_value': 93.0, 'output.value': 80.16199408837772, 'log': '', 'Generator.py': ''}, {'clock_tick': 94.0, 'input.start_value': 94.0, 'output.value': 80.75581004051142, 'log': '', 'Generator.py': ''}, {'clock_tick': 95.0, 'input.start_value': 95.0, 'output.value': 81.34155047893738, 'log': '', 'Generator.py': ''}, {'clock_tick': 96.0, 'input.start_value': 96.0, 'output.value': 81.91915683009982, 'log': '', 'Generator.py': ''}, {'clock_tick': 97.0, 'input.start_value': 97.0, 'output.value': 82.488571333845, 'log': '', 'Generator.py': ''}, {'clock_tick': 98.0, 'input.start_value': 98.0, 'output.value': 83.04973704919705, 'log': '', 'Generator.py': ''}, {'clock_tick': 99.0, 'input.start_value': 99.0, 'output.value': 83.60259786005206, 'log': '', 'Generator.py': ''}, {'clock_tick': 100.0, 'input.start_value': 100.0, 'output.value': 84.14709848078965, 'log': '', 'Generator.py': ''}, {'clock_tick': 101.0, 'input.start_value': 101.0, 'output.value': 84.68318446180152, 'log': '', 'Generator.py': ''}, {'clock_tick': 102.0, 'input.start_value': 102.0, 'output.value': 85.21080219493629, 'log': '', 'Generator.py': ''}, {'clock_tick': 103.0, 'input.start_value': 103.0, 'output.value': 85.72989891886034, 'log': '', 'Generator.py': ''}, {'clock_tick': 104.0, 'input.start_value': 104.0, 'output.value': 86.24042272433384, 'log': '', 'Generator.py': ''}, {'clock_tick': 105.0, 'input.start_value': 105.0, 'output.value': 86.7423225594017, 'log': '', 'Generator.py': ''}, {'clock_tick': 106.0, 'input.start_value': 106.0, 'output.value': 87.23554823449862, 'log': '', 'Generator.py': ''}, {'clock_tick': 107.0, 'input.start_value': 107.0, 'output.value': 87.72005042746817, 'log': '', 'Generator.py': ''}, {'clock_tick': 108.0, 'input.start_value': 108.0, 'output.value': 88.19578068849475, 'log': '', 'Generator.py': ''}, {'clock_tick': 109.0, 'input.start_value': 109.0, 'output.value': 88.66269144494872, 'log': '', 'Generator.py': ''}, {'clock_tick': 110.0, 'input.start_value': 110.0, 'output.value': 89.12073600614355, 'log': '', 'Generator.py': ''}]
    s = GeneralPlugin(input=Input(function=lambda x: math.sin(x / 100)*100), output=Output(), run_function=run, run_post_function=run_post, plugin_name=PLUGIN_NAME, parent=None)
    #verif_dict: {} = list(csv.DictReader(open(verif_file), quoting = csv.QUOTE_NONNUMERIC))
    s.csv.run_test_from_file(verif_dict=testdata)

if __name__ == "__main__":
    test()




